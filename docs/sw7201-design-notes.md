# SW7201 方案设计笔记（DC-DC 段）

## 1. 系统目标与芯片要点（基于 SW7201 数据手册）

- 目标功率：`100 W`，`20 V / 5 A`（USB‑PD 固定档）。
- 输入范围：`4–24 V`；放电电压范围 `3–22 V`；支持最高 `100 W` 输出（数据手册 “Features/Reverse Buck-boost Discharge/Device Comparison Table”）。
- 拓扑/控制：同步四开关 Buck‑Boost；支持 `200/300/400/800 kHz` 切换频率（Device Comparison Table）；支持 I2C 或 FB 调压（Pin `FB` 说明：外部分压，参考固定在 0.5 V；“FB is fixed at 0.5 V.”）；双向充放（本项目聚焦放电为 20 V 源端）。
- 设计取向：优先在 400 kHz 左右折中效率/体积/EMI，电感以 Boost 工况（12→20 V）为最严苛条件确定值与额定。
- 资料索引：`docs/datasheets/sw7201-datasheet.md`（英文版 Markdown 摘要）。
 - 运行边界补充（项目约束）：当 `Vin < 12 V` 时，输出电流上限限定为 `≤ 3 A`（仅作 Source 放电使用），据此在低输入电压下电感峰值与动态跌落更易满足。

## 2. 开关频率设定（锁定 400 kHz 档）

- 芯片支持 `200/300/400/800 kHz`；100 W 应用为抑制开关/驱动损耗及热压力，推荐 ≤500 kHz 档位（仅依据 SW7201 频率选项与大功率常规设计取向）。
- 本版定为 `f_SW = 400 kHz`：
  - 好处：纹波电流/输出电容需求适中；MOSFET 的门极损耗与开关损耗不过高。
  - 约束：对电感饱和/温升仍需以 Boost 满载工况校核。

## 3. 功率电感选型与功率校核

### 3.1 目标与假设

- 目标：Boost 最严苛（12 V → 20 V / 5 A，η≈95%）下，电感纹波比（ΔI_L/IDC）控制在 ≈25–35%。
- 取值：`f_SW = 400 kHz`；候选 `L = 6.8 µH`（屏蔽式、低 DCR、≥20 A 饱和）。

### 3.2 纹波、电流与功率损耗（近似）

- Boost 占空：`D_boost ≈ 1 − Vin/Vout = 1 − 12/20 = 0.4`。
- 电感纹波：`ΔI_L ≈ Vin·D / (L·f) = 12·0.4 / (6.8e−6·400k) ≈ 1.77 A(pk‑pk)`。
- 平均电感电流（≈输入电流）：`I_DC ≈ Pout / (Vin·η) ≈ 100 / (12·0.95) ≈ 8.77 A`。
- 峰值电流：`I_PK ≈ I_DC + ΔI_L/2 ≈ 8.77 + 0.89 ≈ 9.66 A`（建议 ≥30% 裕量 ⇒ `I_SAT ≥ 13 A`，优选 ≥18–20 A）。
- RMS 电流：`I_RMS ≈ sqrt(I_DC^2 + ΔI_L^2/12) ≈ sqrt(8.77^2 + 1.77^2/12) ≈ 8.79 A`。
- 铜耗（估算）：若 `DCR ≈ 10 mΩ`，`P_Cu ≈ I_RMS^2·DCR ≈ 8.83^2·0.01 ≈ 0.78 W`。
- 磁芯损（经验）：400 kHz、此级纹波下约 `0.2–0.5 W`（与材料/体积相关）。
- 结论：电感自发热能力按 `≈1.0–1.3 W` 量级评估，建议选用厂商给出的温升曲线 ≥40 °C@10 A、总损耗能力 ≥2 W 等级的屏蔽功率电感。

### 3.3 器件建议（封装与参数）

- 规格：`6.8 µH`、`Isat ≥ 18–20 A`、`Irms ≥ 10–12 A`、`DCR ≤ 10–12 mΩ`、屏蔽结构、低漏磁。
- 封装体积：建议 `7×7×3–4 mm` 或 `10×10×4–5 mm` 等等级，以保证热容与低 DCR。
- 参考料号（同级替换）：Coilcraft XAL7070‑682、Chilisin/Sunlord 6R8 同级屏蔽电感（以 DCR/Isat/尺寸匹配为准）。

> 若需进一步降低纹波，可选 `L=8.2–10 µH`；若优先减小尺寸且热/损耗允许，可评估 `L=4.7–5.6 µH` 并相应上调输出电容与 OCP 阈值。

## 4. 外置 MOSFET 选型（四开关桥臂）

SW7201 为控制器方案，需要外置 4 只 MOSFET（两臂半桥）。100 W/40 V 等级建议（不参考其它厂商器件资料，仅结合 SW7201 的工作范围与本仓已收录 MOSFET 数据手册进行选型）：

- 电压等级：`VDS = 40 V`（输入上限 24 V + 尖峰裕量）。
- 栅极：逻辑电平型，`RDS(on)` 在 `VGS=4.5–5 V` 有明确指标；`VGS(max) ≥ ±20 V`（SW7201 手册列出了电源/控制特性与外部 FB/检测脚位，但未给出精确栅驱电压幅值，故按常见 4.5–5 V 等级器件保守选型）。
- 封装：DFN5×6 / PowerPAK / LFPAK56 等低寄生方案；大铜皮与过孔散热。
- 候选与分工（与本仓已有器件匹配）：
  - 高边优先：`NCEP4090GU`（40 V，`RDS(on) ≈ 3.3 mΩ@4.5 V`，`Qg ≈ 40 nC`）→ 损耗/热余量好，适合作为两臂高边与关键位。
  - 低边可选：`NCEP4045GU`（40 V，`RDS(on) ≈ 6.6–8.5 mΩ@4.5 V`，门极与恢复指标较优）或同样使用 `NCEP4090GU` 统一料号。
- 建议组合：
  - 基线 A：四只均用 `NCEP4090GU`（最简、低阻抗、热更优）。
  - 基线 B：高边 `NCEP4090GU` ×2，低边 `NCEP4045GU` ×2（综合成本与驱动/EMI）。
- 驱动/EMI 提示：以 `1–3 Ω` 栅电阻折中 dv/dt 与振铃；必要时在各臂加 RC Snubber。

参考数据：`docs/datasheets/ncep4090gu-datasheet.md`、`docs/datasheets/ncep4045gu-datasheet.md`（均为本仓 Markdown 版数据手册）。

## 5. 输入 / 输出电容规划

> 以下以 Boost 满载 12→20 V 为最严苛工况；目标输出纹波 Vr ≈ 20–25 mV（电容本体分量），并兼顾 ESR 纹波。

### 5.1 输出侧（VBUS 20 V / 5 A）

- 纹波电流（电容通道）：`I_AC,out ≈ I_OUT·(1 − Vin/Vout) = 5·0.4 = 2.0 A`。
- 容性纹波（忽略 ESR）：`Vr_CAP ≈ I_AC / (C_EQ·f_SW) = 2 / (C_EQ·400k)`。
  - 若 `Vr_CAP ≤ 20 mV` ⇒ `C_EQ ≥ 250 µF`；若 `≤ 25 mV` ⇒ `C_EQ ≥ 200 µF`。
- ESR 约束：`Vr_ESR = I_AC · ESR ≤ 20 mV` ⇒ `ESR_EQ ≤ 10 mΩ`（25 mV ⇒ ≤12.5 mΩ）。
- 建议堆栈：
  - 聚合物/固态：`2× 100–150 µF / 35 V` 低 ESR 电容（每颗 ESR≈20–30 mΩ，串并联实现 `≤10–15 mΩ` 等效）。如需使用 25 V 等级，必须配合 TVS/吸收与波形实测，确保过冲峰值始终低于额定耐压（量产基线仍推荐 35 V）。
  - MLCC：`2× 22 µF / 25 V X7R` + `1 µF + 0.1 µF`（贴近桥臂/电感输出，抑制高频分量）。
  - 若体积允许，追加 `1× 220 µF / 25–35 V` 聚合物作为缓冲以降低负载阶跃下的跌落。

### 5.2 电池侧/输入侧（上游 12–24 V 总线）

- Boost 满载下输入平均电流约 `8.8–9.0 A`，高频电流主要经输入 MLCC 回路。
- 建议堆栈：
  - 近芯片高频：`2× 22 µF / 35 V X7R` + `10 µF + 1 µF + 0.1 µF`（1210/1206 组合，紧耦合 `VIN–高边–低边–PGND` 回路）。
  - 母线缓冲：`1× 220–470 µF / 35 V` 聚合物/电解（靠近输入接口，抑制低频纹波与线缆谐振；24 V 直流母线不建议使用 25 V 器件，以保证热插拔/谐振尖峰的耐压裕量）。
- 注意直流偏压下 MLCC 实际等效容量衰减，请按 30–50% 计入余量。电流检测网络按 SW7201 手册建议在 VBUS 侧采样电阻并联 100 nF，且在采样与 CS 引脚间加低通（参见手册 “VBUS current sensing low-pass filter parameter selection” 说明），以提高限流与 OCP 的稳定性。

## 6. 小结（第一版 BOM 建议）

- 电感（主功率）：`6.8 µH` 屏蔽功率电感，`Isat ≥ 18–20 A`、`Irms ≥ 10–12 A`、`DCR ≤ 10–12 mΩ`；尺寸 7×7×3–4 mm 或 10×10×4–5 mm；估算损耗 ≈ `1.0–1.3 W`（需结合样机热测实锤）。
- MOSFET（四只）：
  - 方案 A：`NCEP4090GU ×4`（40 V，DFN5×6）。
  - 方案 B：`NCEP4090GU ×2`（高边） + `NCEP4045GU ×2`（低边）。
- 输出电容：`2× 100–150 µF / 25–35 V` 聚合物 + `2× 22 µF / 25 V X7R` + `1 µF + 0.1 µF`。
- 输入电容：近芯片 `2× 22 µF / 35 V X7R` + `10 µF + 1 µF + 0.1 µF`；接口侧 `220–470 µF / 25–35 V` 聚合物/电解。
- 开关频率：`400 kHz` 档（后续可在 300–400 kHz 微调以平衡热/体积/EMI）。

## 7. 备忘与后续验证要点

- 样机阶段测量各桥臂栅源波形与电感温升；必要时加 `1–3 Ω` 栅电阻与 RC Snubber。
- 记录输出纹波（20 V/5 A，12 V 输入）与瞬态响应；必要时增加聚合物并联或提高 MLCC 贴装密度。
- 若 12 V 源阻较高（线缆较长），输入侧需 TVS/RC 吸收与大体量聚合物，避免振铃加大 MOSFET 尖峰。

> 附注：SW7201 亦支持 I2C 模式限制输出电流与设置电压，最终电容/电感/限流建议以目标固件配置为准做一次联动校核。

## 8. 动态响应校核（1 W → 65 W，跌落 ≤ 2 V 或 5%）

- 要求解释：以 `VOUT=20 V` 为例，5% 为 `1 V`，与 `2 V` 比较取更严者，因此目标为负载阶跃下电压跌落 `≤ 1 V`。
- 负载阶跃：`1 W → 65 W`，等效电流阶跃 `ΔI ≈ (65−1)/20 ≈ 3.2 A`（实取 3.25 A 保守）。
- 瞬时跌落分量：
  - ESR 跌落：`ΔV_ESR = ΔI · ESR_EQ`。
  - 容性跌落（控制环尚未完全响应之前）：`ΔV_C ≈ ΔI · Δt / C_EQ`，其中 `Δt` 约为“控制延迟 + 电感电流爬升时间”。

### 8.1 以推荐参数验证（fSW=400 kHz；L=6.8 µH；C_EQ≈200–250 µF；ESR_EQ≈10–12.5 mΩ）

- 电感爬升斜率（Boost 12 V 工况）：`di/dt ≈ Vin / L = 12 / 6.8e−6 ≈ 1.76 A/µs`。
- 使电感电流补足 `ΔI=3.25 A` 需时：`t_L ≈ ΔI/(di/dt) ≈ 1.85 µs`。
- 控制/开关延迟：保守按 `≈1 个周期` 计 `T_SW=1/fSW=2.5 µs`。
- 估计总延迟：`Δt ≈ T_SW + t_L ≈ 2.5 + 1.85 ≈ 4.35 µs`。
- 跌落实测上限估算：
  - `ΔV_ESR ≈ 3.25 A × 0.010 Ω = 0.0325 V`（ESR 较小，贡献次要）。
  - `ΔV_C ≈ 3.25 A × 4.35 µs / 200 µF ≈ 0.071 V`（若 `C_EQ=250 µF` 则 ≈ `0.057 V`）。
  - 总计 `ΔV_total ≈ 0.10–0.13 V ≪ 1 V`，满足“≤ 1 V”目标，且有足量余量。

### 8.2 对比：若选 L=4.7 µH（其余不变）

- 斜率更大：`di/dt ≈ 12 / 4.7e−6 ≈ 2.55 A/µs`，`t_L ≈ 3.25/2.55 ≈ 1.28 µs`，`Δt ≈ 2.5 + 1.28 ≈ 3.78 µs`。
- `ΔV_C` 更小：`≈ 3.25×3.78 µs/200 µF ≈ 0.061 V`；`ΔV_ESR` 不变。
- 结论：4.7 µH 在动态上略占优（更快爬升→更小跌落），但其稳态纹波与 EMI、核损压力较 6.8 µH 更高，需在输出电容与抑振/滤波上补偿。

### 8.3 结论与实施

- 在“1 W → 65 W、跌落 ≤ 1 V”的约束下，`L=6.8 µH + C_EQ=200–250 µF + ESR_EQ≤10–12.5 mΩ` 的推荐组合已有显著余量。
- 若优先动态（或为未来更大阶跃预留极限余量），可用 `L=4.7 µH`；但需：
  - 提升输出 MLCC 贴装密度或并联额外聚合物，以抑制更高的电流纹波分量。
  - 评估并优化栅极串阻/RC Snubber 与采样 RC 低通（SW7201 手册对 CS/VBUS 采样与低通有明确建议），确保 OCP/环路稳定且不迟钝。

## 9. 驱动电源去耦（VDRV）

- 引脚定位：`VDRV`（见引脚图 28 脚），为门极驱动/内部驱动电源轨，应就近对地去耦。
- 选型（与官方做法对齐）：`10 µF / 25 V / X7R / 0603`，靠近 `VDRV` 与地引脚，走线极短、环路最小。不并联额外 0.1 µF 小电容。
- 说明：遵循数据手册与参考设计/EVM的最小必需配置；如后续实测确有高频尖峰，再依据波形评估是否临时加装小电容或阻尼网络。
